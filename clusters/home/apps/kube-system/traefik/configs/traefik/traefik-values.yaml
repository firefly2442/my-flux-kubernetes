apiVersion: helm.cattle.io/v1
kind: HelmChartConfig
metadata:
  name: traefik
  namespace: kube-system
spec:
  # https://github.com/traefik/traefik-helm-chart/blob/master/traefik/values.yaml
  valuesContent: |-
    # Create an IngressRoute for the dashboard
    ingressRoute:
      dashboard:
        enabled: true
        matchRule: Host(`traefik.homelab.rivetcode.com`)
        entryPoints: ["web", "websecure"]
    logs:
      access:
        enabled: true
    # setup cert manager and lets encrypt
    env:
    - name: CF_DNS_API_TOKEN
      valueFrom:
        secretKeyRef:
          name: cloudflare-api-token-secret
          key: api-token
    certificatesResolvers:
      letsencrypt:
        acme:
          email: firefly2442@gmail.com
          storage: /data/acme.json
          httpChallenge:
            entryPoint: web
          dnsChallenge:
            provider: cloudflare
            delayBeforeCheck: 0
            resolvers:
              - "1.1.1.1:53"
              - "8.8.8.8:53"
